import com.moowork.gradle.node.task.NodeTask

plugins {
	id 'base'
	id 'com.moowork.node' version '1.3.1'
}

configurations {
	antCompile
	providedCompile
}

node {
	version = '10.15.3'
	npmVersion = '6.1.0'
	download = true
}

task npmAuditFix(type: NpmTask, dependsOn: 'npmInstall') {
	args = ['audit', 'fix', '--force']
}

task npmUpdate(type: NpmTask, dependsOn: 'npmInstall') {
	args = ['update', '--save']
}

task vueCliBuild(type: NodeTask, dependsOn: 'npmInstall') {
    def osName = System.getProperty('os.name').toLowerCase();
    if (osName.contains('windows')) {
        script = project.file('node_modules/@vue/cli-service/bin/vue-cli-service.js')
    } else {
        script = project.file('node_modules/.bin/vue-cli-service')
    }
	args = ['build']
}

task vueCliServe(type: NodeTask, dependsOn: 'npmInstall') {
    def osName = System.getProperty('os.name').toLowerCase();
    if (osName.contains('windows')) {
        script = project.file('node_modules/@vue/cli-service/bin/vue-cli-service.js')
    } else {
        script = project.file('node_modules/.bin/vue-cli-service')
    }
	args = ['serve']
}

clean.delete << file('node_modules')
clean.delete << file('dist')